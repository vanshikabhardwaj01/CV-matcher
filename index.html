<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RESUMEMATE</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.35.0/apexcharts.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --pink: #fb7185; --pink-light: #fff1f2; --slate: #1e293b; --bg: #fafafa; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; color: var(--slate); }
        .sidebar { width: 320px; background: white; border-right: 1px solid #fce7f3; padding: 30px; overflow-y: auto; }
        .content { flex: 1; padding: 30px; overflow-y: auto; display: grid; grid-template-columns: 1fr 340px; gap: 25px; }
        .card { background: white; border-radius: 20px; padding: 25px; border: 1px solid #fce7f3; box-shadow: 0 10px 25px rgba(251, 113, 133, 0.05); margin-bottom: 20px; }
        .badge { background: var(--pink-light); color: var(--pink); padding: 8px 15px; border-radius: 12px; font-weight: 700; font-size: 11px; margin: 4px; display: inline-block; text-transform: uppercase; }
        .badge-missing { background: #f1f5f9; color: #94a3b8; padding: 8px 15px; border-radius: 12px; font-weight: 700; font-size: 11px; margin: 4px; display: inline-block; text-transform: uppercase; }
        .btn { background: var(--pink); color: white; border: none; padding: 15px; border-radius: 12px; font-weight: 700; cursor: pointer; width: 100%; transition: 0.3s; margin-top: 10px; }
        textarea, input { width: 100%; padding: 12px; border: 1px solid #f1f5f9; border-radius: 10px; margin-top: 8px; box-sizing: border-box; }
        .job-card { background: white; border: 1px solid #fce7f3; padding: 18px; border-radius: 15px; margin-bottom: 12px; border-left: 5px solid var(--pink); }
    </style>
</head>
<body>
<div class="sidebar">
    <h1 style="color: var(--pink); margin: 0; font-size: 24px;">CV MATCHER</h1>
    <div style="margin-top: 25px;">
        <label><b>Upload Resume (PDF)</b></label><input type="file" id="res">
        <label style="display:block; margin-top:15px;"><b>Job Role</b></label>
        <textarea id="jd" rows="4" placeholder="e.g. Python Developer"></textarea>
    </div>
    <button class="btn" onclick="analyze()">ANALYZE NOW</button>
</div>
<div class="content">
    <div>
        <div class="card"><h3>Fit Score</h3><div id="pie"></div></div>
        <div class="card"><h3>Skill Map</h3><div id="matched"></div><div id="missing" style="margin-top:10px;"></div></div>
    </div>
    <div><h3>Live Jobs</h3><div id="joblist">Waiting...</div></div>
</div>

<script>
    let chart = null;
    async function analyze() {
        const file = document.getElementById('res').files[0];
        if (!file) return alert("Upload Resume!");
        document.getElementById('joblist').innerHTML = "Scanning...";
        
        const formData = new FormData();
        formData.append('resume', file);
        formData.append('job_description', document.getElementById('jd').value);

        try {
            // Logs wala active link
            const res = await fetch('https://cv-matcher-pufpsn735-jdfw5wvfqjtcgg54m.vercel.app/match', {
                method: 'POST',
                body: formData
            });
            const data = await res.json();
            
            if(chart) chart.destroy();
            chart = new ApexCharts(document.querySelector("#pie"), {
                series: [data.score, 100 - data.score],
                chart: { type: 'donut', height: 250 },
                colors: ['#fb7185', '#f1f5f9'],
                plotOptions: { pie: { donut: { labels: { show: true, total: { show: true, label: 'Fit', formatter: () => data.score + '%' } } } } }
            }).render();

            document.getElementById('matched').innerHTML = data.matched_skills.map(s => `<span class="badge">${s}</span>`).join('');
            document.getElementById('missing').innerHTML = data.missing_skills.map(s => `<span class="badge-missing">${s}</span>`).join('');
            document.getElementById('joblist').innerHTML = "Analysis Complete!";
        } catch (e) { 
            document.getElementById('joblist').innerHTML = "Error!"; 
            console.log(e);
        }
    }
</script>
</body>
</html>
